---
name: tdd
description: TDD(Test-Driven Development) 기반으로 기능을 구현하는 워크플로우. 사용자가 명시적으로 TDD를 요청할 때만 사용한다. 예시 트리거 - "TDD로 진행해줘", "테스트 먼저 작성해줘", "TDD 모드로". 기능 단위로 선택적 적용이 가능하다. Do NOT auto-trigger. Only activate when the user explicitly requests TDD-based development.
---

# TDD 워크플로우

사용자가 명시적으로 TDD를 요청했을 때만 활성화한다. 자동 트리거하지 않는다.

## 워크플로우 개요

```
요구사항 → 테스트 설계 → [Red → Green → Refactor]ₙ → 검증
```

## Step 1: 테스트 설계

구현 전에 테스트를 먼저 설계한다.

### 1-1. 요구사항을 동작(behavior) 단위로 분해

기능을 테스트 가능한 단위로 나눈다:
- 정상 경로 (happy path)
- 에러 경로 (error cases)
- 경계값 (boundary values)

### 1-2. 테스트 명세 작성

각 동작에 대해 Given-When-Then 형식으로 명세:

```
테스트: [의도를 설명하는 이름]
  Given: [사전 조건]
  When:  [실행할 동작]
  Then:  [기대 결과]
```

### 1-3. 우선순위 결정

핵심 경로 → 에러 경로 → 경계값 → 엣지 케이스 순서로 정렬한다.

**테스트 목록을 사용자에게 제시하고 확인받은 뒤 사이클에 진입한다.**

## Step 2: Red-Green-Refactor 사이클

테스트 목록에서 하나씩 순서대로 진행한다.

### Red: 실패하는 테스트 작성

1. 테스트 목록에서 다음 테스트 선택
2. 테스트 가능성 판단 (불가능하면 → [폴백 전략](#폴백-전략) 참조)
3. 실패하는 테스트 코드 작성
4. **테스트 실행 → 실패 확인** (반드시 실행하여 실패를 눈으로 확인)

### Green: 최소 구현

1. 테스트를 통과시키는 **최소한의** 코드 작성
2. 과도한 일반화 금지 — 현재 테스트만 통과시킨다
3. **테스트 실행 → 통과 확인**

### Refactor: 정리

1. 코드 냄새 제거 (중복, 매직넘버, 긴 메서드 등)
2. 테스트 코드도 정리 대상
3. **테스트 실행 → 여전히 통과 확인**

### 다음 사이클

- 테스트 목록에 남은 항목 → Red로 복귀
- 모두 완료 → Step 3으로

**각 사이클 완료 시 진행 상황을 표시한다:** `[3/7] ✓ 음수 입력 시 예외 발생`

## Step 3: 검증

1. 새 테스트 + 기존 테스트 모두 실행
2. 회귀 없음 확인
3. 모든 요구사항이 테스트로 커버되었는지 확인
4. 폴백 적용 영역은 대안 검증 완료 여부 확인

## 폴백 전략

TDD를 적용했지만 특정 부분이 테스트하기 어려울 때 사용한다.

### 테스트 불가능한 영역 판단 기준

| 상황 | 대안 |
|------|------|
| 외부 시스템 의존 (DB, API, 하드웨어) | 핵심 로직을 분리하여 해당 부분만 단위 테스트. 통합 부분은 수동 검증 체크포인트 정의 |
| 모킹이 과도하게 복잡 | 인터페이스 경계를 재설계하거나, 통합 테스트로 전환 |
| UI/레이아웃 | 로직만 분리 테스트. 시각적 부분은 제외 |
| 프로젝트 설정/스캐폴딩 | TDD 대상에서 제외. 설정 후 스모크 테스트로 검증 |
| 테스트 인프라 미비 | 최소한의 assertion 기반 검증 또는 "구현 후 테스트 추가" 방식 전환 |

폴백 적용 시 사용자에게 사유를 설명한다:
> "이 부분은 [사유]으로 인해 TDD 대신 [대안]으로 검증합니다."

## TDD 적합성 가이드

사용자가 판단을 요청하면 참고한다.

**적합:**
- 순수 로직/알고리즘 (입력 → 출력 명확)
- 기존 코드 리팩토링 (회귀 방지)
- 복잡한 비즈니스 규칙
- API/인터페이스 설계

**부적합:**
- 프로젝트 초기 설정, 빌드 구성
- UI 레이아웃/디자인
- 일회성 스크립트, 빠른 프로토타이핑
- 전체가 외부 의존인 코드
