# 프로젝트 수준 레이어 가이드

전체 시스템, 프로젝트, 또는 여러 모듈에 걸친 계획에 적용한다.

## Layer 1: 큰 그림

"무엇을 하는가"에 집중한다.

### 초안 포함 항목

- **목표**: 한 문장으로 정리한 최종 목표
- **주요 단계**: 3~7개, 각각 한 줄 설명. 순서는 의존성을 반영
- **범위**: 포함/제외를 명시
- **선행 조건**: 시작 전에 필요한 것

### 핵심 질문

> **[핵심]** "단계 구성이 이 방향이 맞습니까? 빠진 단계나 불필요한 단계가 있으면 알려주세요."

도메인별 추가 질문:

**소프트웨어 설계/구현:**
> **[핵심]** "이 시스템의 가장 중요한 품질 속성은 무엇입니까? (예: 성능, 확장성, 유지보수성, 사용 편의성)"
> "기존 시스템과 통합해야 하는 부분이 있습니까?"

**프로젝트 계획:**
> **[핵심]** "데드라인이나 고정된 일정 제약이 있습니까?"
> "팀 규모와 가용 리소스는 어떻습니까?"

**문서/콘텐츠:**
> **[핵심]** "대상 독자는 누구입니까? (기술 수준, 배경지식)"
> "참고할 기존 문서 스타일이 있습니까?"

---

## Layer 2: 구성요소

"어떻게 하는가"의 첫 단계. Layer 1의 확정된 단계 중 **하나씩** 순서대로 진행한다.

### 초안 포함 항목

- **목표**: 이 단계가 달성해야 하는 것
- **구성요소**: 각각 역할과 산출물 명시
- **의존성**: 구성요소 간 순서 관계
- **리스크**: 식별된 리스크와 대응 방안

### 핵심 질문

> **[핵심]** "이 분해가 적절합니까? 빠진 구성요소나 합쳐야 할 구성요소가 있습니까?"

도메인별 추가 질문:

**소프트웨어:** 컴포넌트 간 인터페이스/경계, 재사용 가능한 기존 코드, 테스트 전략, 에러 처리 전략
**프로젝트 계획:** 마일스톤별 예상 소요 시간, 병렬 진행 가능 여부, 외부 의존성
**문서/콘텐츠:** 챕터 간 의존성, 시각 자료 필요 여부, 리뷰 프로세스

---

## Layer 3: 세부 명세

"정확히 무엇을 해야 하는가". Layer 2의 확정된 구성요소 중 **하나씩** 순서대로 진행한다.

### 초안 포함 항목

- **작업 항목**: 각각 입력/출력/완료 조건 명시
- **제약사항**: 기술적/비즈니스 제약
- **열린 질문**: 아직 결정되지 않은 사항
- **기술 명세** (소프트웨어일 때): 파일/클래스, 인터페이스, 데이터 구조
- **하위 계획 위임** (해당 시): 구성요소가 크고 복잡하지만 독립적인 경우, 작업 항목 대신 `[하위 계획 위임]` 마커와 인터페이스 경계만 정의 (SKILL.md "하위 계획 위임" 절차 참조)

### 핵심 질문

> **[핵심]** "작업 항목이 명확하고 실행 가능합니까? 애매한 부분이나 추가 분해가 필요한 항목이 있습니까?"

도메인별 추가 질문:

**소프트웨어:**
> **[핵심]** "API 시그니처와 데이터 모델이 명확합니까? 빠진 필드나 메서드가 있습니까?"
> "예외 케이스와 에러 처리는 어떻게 할 것입니까?"
> "성능 요구사항이 있다면 구체적인 수치는 무엇입니까? (예: 응답 시간, 처리량)"

**프로젝트 계획:**
> **[핵심]** "각 작업의 담당자와 구체적인 일정이 현실적입니까?"
> "완료 기준이 명확하고 측정 가능합니까?"
> "의존성이 있는 작업의 순서가 적절합니까?"

**문서/콘텐츠:**
> **[핵심]** "각 섹션의 핵심 내용이 명확합니까? 독자가 이해하기에 충분합니까?"
> "예시나 코드 샘플의 범위가 적절합니까?"
> "용어 정의가 필요한 부분이 있습니까?"

---

## 출력 템플릿

### Layer 1 예시

```
## 채팅 시스템 구현 — Layer 1: 큰 그림

### 목표
실시간 1:1 및 그룹 채팅 시스템을 구현하여 사용자 간 텍스트 메시지 교환을 지원한다.

### 주요 단계
1. 메시지 전송 기반 — WebSocket 기반 실시간 메시지 송수신 인프라
2. 채팅방 관리 — 1:1 및 그룹 채팅방 생성/참여/퇴장 로직
3. 메시지 저장 — 메시지 영속화 및 히스토리 조회
4. 알림 시스템 — 읽지 않은 메시지 카운트 및 푸시 알림
5. UI 구현 — 채팅 목록, 채팅방, 메시지 입력 화면

### 범위
- 포함: 텍스트 메시지, 읽음 확인, 채팅방 관리
- 제외: 파일 첨부, 음성/영상 통화, 메시지 검색

### 선행 조건
- 사용자 인증 시스템 완료
- WebSocket 서버 환경 준비
```

### Layer 2 예시

```
### 메시지 전송 기반 — Layer 2: 구성요소

#### 목표
클라이언트-서버 간 실시간 양방향 메시지 전달 파이프라인 구축

#### 구성요소
1. WebSocket 연결 관리
   - 역할: 연결 수립, 유지, 재연결 처리
   - 산출물: ConnectionManager 클래스
2. 메시지 직렬화
   - 역할: 메시지 객체 ↔ JSON 변환
   - 산출물: MessageSerializer, 메시지 스키마 정의
3. 메시지 라우팅
   - 역할: 수신 메시지를 올바른 채팅방/사용자에게 전달
   - 산출물: MessageRouter 클래스

#### 의존성
- [WebSocket 연결 관리] → [메시지 직렬화] → [메시지 라우팅]

#### 리스크
- 네트워크 불안정 시 메시지 유실 → 재전송 큐 메커니즘 필요
```

### Layer 3 예시

```
#### WebSocket 연결 관리 — Layer 3: 세부 명세

##### 작업 항목
- [ ] WebSocket 핸드셰이크 구현
  - 입력: 서버 URL, 인증 토큰
  - 출력: 활성 WebSocket 연결
  - 완료 조건: 인증된 사용자가 연결 수립 성공
- [ ] 하트비트/핑퐁 구현
  - 입력: 활성 연결
  - 출력: 연결 상태 모니터링
  - 완료 조건: 30초 간격 핑, 5초 타임아웃 감지
- [ ] 자동 재연결 구현
  - 입력: 끊어진 연결
  - 출력: 복구된 연결
  - 완료 조건: 지수 백오프로 최대 5회 재시도

##### 기술 명세
- 파일: `src/network/ConnectionManager.ts`
- 인터페이스: `connect()`, `disconnect()`, `onMessage()`, `send()`
- 데이터: `ConnectionState` enum (Connecting, Connected, Reconnecting, Disconnected)

##### 제약사항
- 동시 연결은 1개만 허용
- 재연결 중 메시지 큐 최대 100개

##### 열린 질문
- 재연결 실패 시 사용자에게 어떤 UI를 보여줄 것인가?
```

### 최종 계획서 구조

```
# [주제] — 점진적 계획서

## 개요
- 목표: [최종 목표]
- 강도: [사용된 질문 강도]
- 범위: 포함 / 제외

## 요구사항 및 설계 의도
Q&A 과정에서 파악한 핵심 의도와 요구사항을 정리한다.

- **핵심 의도**: [사용자가 이 계획으로 궁극적으로 달성하려는 것]
- **품질 우선순위**: [성능 > 유지보수성 등 사용자가 밝힌 우선순위]
- **명시적 제약**: [데드라인, 기술 스택, 리소스 등 사용자가 밝힌 제약]
- **선호/비선호**: [사용자가 명시적으로 원하거나 원하지 않는 방향]

## Layer 1: 큰 그림
[Phase 1 확정 내용 전체]

## Layer 2: 구성요소
### 단계 1: [단계명]
[Phase 2 확정 내용]
### 단계 2: [단계명]
[Phase 2 확정 내용]

## Layer 3: 세부 명세
### 단계 1 > 구성요소 1
[Phase 3 확정 내용]
### 단계 1 > 구성요소 2
[Phase 3 확정 내용]

## 위임된 하위 계획
| 구성요소 | 책임 | 인터페이스 경계 |
|----------|------|----------------|
(위임된 항목이 없으면 이 섹션 생략)

## 열린 질문
- [아직 결정되지 않은 사항들]

## 리스크 요약
| 리스크 | 영향도 | 대응 방안 |
|--------|--------|----------|
```
