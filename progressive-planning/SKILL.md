---
name: progressive-planning
description: 계획, 설계, 구현을 한 번에 완성하지 않고 점진적으로 조립하는 대화형 워크플로우. 큰 그림에서 세부사항으로 레이어별 질문과 정제를 반복하며 계획을 구축한다. 인자로 "--depth thorough|moderate|quick"과 주제를 받을 수 있다. Use for planning, designing, or implementing anything that benefits from incremental refinement. Do NOT use for simple tasks completable in one step.
---

# 점진적 계획 수립 워크플로우

계획, 설계, 구현을 한 번에 완성하지 않고 큰 그림에서 세부사항으로 단계적으로 조립하는 워크플로우.
각 레이어에서 초안 제시 → 질문 → 정제 → 확정 순서를 반복한다.

## 진입 조건

**이 스킬이 활성화되면 가장 먼저 `EnterPlanMode` 도구를 호출하여 Plan 모드로 진입한다.**
Plan 모드에서는 코드베이스 탐색과 계획 수립에 집중하며, 코드 편집은 수행하지 않는다.
최종 계획이 확정되면 `ExitPlanMode`로 Plan 모드를 종료하고 구현 단계로 전환한다.

> Plan 모드 진입 → Phase 0~4 진행 → 계획 확정 → ExitPlanMode → (선택) 구현 시작

## 핵심 원칙

1. **한 번에 완성하지 않는다.** 전체 계획을 한 번에 출력하지 않는다. 레이어별로 초안 → 질문 → 정제 → 확정을 반복한다.
2. **위에서 아래로 내려간다.** 상위 레이어가 확정된 뒤에 하위 레이어를 시작한다. 세부사항부터 결정하지 않는다.
3. **핵심 분기를 건너뛰지 않는다.** 방향을 결정하는 `[핵심]` 질문은 반드시 답변을 받는다. 비핵심 질문만 건너뛸 수 있다.
4. **초안 오류는 즉시 수정한다.** 사용자가 오류를 지적하면 수정 후 다시 제시한 뒤 진행한다.
5. **질문 강도는 사용자가 결정한다.** 질문의 양과 깊이는 사용자가 설정한 강도에 따른다.

## 질문 전달 방식

`AskUserQuestion` 도구와 일반 텍스트를 질문 성격에 따라 구분한다.

**`AskUserQuestion` 사용 (선택형 질문):**
- 선택지가 2~4개로 명확히 정의되는 질문에만 사용한다
- 한 번 호출에 질문 1~4개, 각 질문당 선택지 2~4개 (Other는 자동 추가)
- header는 12자 이내, multiSelect는 복수 선택이 필요할 때만 true
- **선택지 1개 또는 5개 이상으로 호출하면 에러 발생** — 반드시 2~4개 범위를 지킨다

**일반 텍스트 사용 (개방형 질문):**
- 자유 답변이 필요하거나 선택지를 특정할 수 없는 질문
- 초안 제시와 함께 피드백을 요청하는 질문
- 여러 개방형 질문을 번호로 나열할 때

## 다이어그램 규칙

구조, 흐름, 의존성 등을 시각화할 때는 반드시 **Mermaid** 문법을 사용한다. 텍스트 ASCII 아트로 그리지 않는다.

- **가독성 우선**: 노드 수가 많으면 방향(`LR`/`TB`)을 적절히 선택하고, subgraph로 그룹화한다
- **레이아웃 깨짐 방지**: 노드 텍스트에 특수문자 사용 시 따옴표로 감싸고, 한 줄에 너무 많은 연결을 넣지 않는다
- **다이어그램 종류 선택 기준**:

| 상황 | Mermaid 다이어그램 |
|------|-------------------|
| 구성요소 간 의존성/관계 | `graph LR` 또는 `graph TB` |
| 시간 순서/처리 흐름 | `sequenceDiagram` |
| 상태 전이 | `stateDiagram-v2` |
| 클래스 구조 | `classDiagram` |
| 일정/단계별 진행 | `gantt` |

---

## Phase 0: 초기화

### Step 1: 질문 강도 결정

인자에 `--depth` 값이 있으면 해당 레벨로 설정한다. 없으면 질문한다:

> "질문 강도를 선택해주세요:
> - **집요** (thorough): 모든 분기점과 세부사항을 질문합니다. 빈틈없는 계획을 만듭니다.
> - **적당** (moderate): 핵심 분기만 질문하고 나머지는 합리적 판단으로 채웁니다. [기본값]
> - **빠르게** (quick): 핵심 질문 1-2개만 하고 빠르게 진행합니다."

**강도별 동작 차이:**

| 동작 | 집요 | 적당 | 빠르게 |
|------|------|------|--------|
| 핵심 분기 질문 | 전부 질문 | 전부 질문 | 최소 1-2개만 |
| 확인 질문 | 전부 질문 | 건너뛰기 가능 | 전부 건너뜀 |
| 세부 옵션 질문 | 전부 질문 | 일부만 질문 | 전부 건너뜀 |
| 초안 제시 후 확인 | 매 레이어 | 매 레이어 | Layer 1만 |
| 레이어 간 중간 정리 | 수행 | 간략 수행 | 생략 |

### Step 2: 주제, 스코프, 도메인 파악

인자에 주제가 있으면 해당 주제로 시작한다. 없으면 질문한다:

> "무엇에 대한 계획/설계를 수립하시겠습니까? 한 줄로 목표를 설명해주세요."

응답을 바탕으로 **스코프**를 판단하고 해당 레이어 가이드를 로드한다:

- **프로젝트 수준** → [project-scope.md](references/project-scope.md) 참조
  - 전체 시스템, 프로젝트, 또는 여러 모듈에 걸친 계획
  - 예: "채팅 시스템 구현", "프로젝트 일정 수립"
- **세부 설계 수준** → [detail-scope.md](references/detail-scope.md) 참조
  - 특정 기능, 서브시스템, 디자인 패턴, 모듈 내부 설계
  - 예: "이벤트 시스템 설계", "상태 관리 패턴 결정", "인증 모듈 아키텍처"

스코프에 따라 각 레이어의 의미가 달라진다:

| 레이어 | 프로젝트 수준 | 세부 설계 수준 |
|--------|--------------|---------------|
| Layer 1 | 큰 그림 — 목표, 주요 단계, 범위 | 설계 방향 — 목적, 패턴 선택, 설계 의도 |
| Layer 2 | 구성요소 — 역할, 산출물, 의존성 | 구조 설계 — 구성요소, 인터페이스, 흐름 |
| Layer 3 | 세부 명세 — 작업 항목, 완료 조건 | 구현 명세 — 클래스/메서드, 데이터, 코드 패턴 |

### Step 3: 기존 맥락 확인

> "이 계획과 관련된 기존 문서, 코드베이스, 또는 참고 자료가 있습니까? (없으면 '없음')"

- 있으면: 해당 자료를 탐색한 뒤 Phase 1 진행
- 없으면: 바로 Phase 1 진행

---

## Phase 1~3: 레이어별 점진적 조립

Phase 1(Layer 1) → Phase 2(Layer 2) → Phase 3(Layer 3) 순서로 진행한다.
각 Phase의 구체적인 초안 포함 항목, 질문, 출력 형식은 스코프별 가이드를 따른다.

### 공통 진행 절차 (모든 Phase에 동일 적용)

**A. 초안 제시**
- 스코프별 가이드의 해당 레이어 "초안 포함 항목"에 따라 초안을 작성하고 제시한다
- 출력 형식은 스코프별 가이드의 "출력 템플릿"을 참조한다

**B. 핵심 질문**
- 스코프별 가이드의 해당 레이어 "핵심 질문"을 제시한다
- `[핵심]` 태그가 붙은 질문은 건너뛸 수 없다 (아래 "질문 유형 분류" 참조)

**C. 정제 및 확정**
- 사용자 응답을 반영하여 초안을 수정한다
- 수정 사항을 명시하고 확정한다

**D. 반복 (Phase 2, 3)**
- Phase 2: Layer 1의 확정된 단계/영역을 **하나씩** 순서대로 진행한다
- Phase 3: Layer 2의 확정된 구성요소를 **하나씩** 순서대로 진행한다
- 각 대상에 대해 A→B→C를 반복한다

---

## 하위 계획 위임

Layer 3 진행 중 특정 구성요소가 그 자체로 크고 복잡한 서브시스템인 경우, 구체적 구현 명세를 작성하는 대신 **별도의 progressive-planning 세션으로 위임**할 수 있다.

### 위임 조건 (두 조건 모두 충족해야 함)

1. **충분히 크고 복잡하다**: 해당 구성요소만으로도 별도의 Layer 1~3 분해가 필요한 규모
2. **독립적이다**: 다른 구성요소와 강하게 커플링되지 않으며, 인터페이스/경계만 정의하면 나머지 계획에 영향을 주지 않음

### 위임 절차

1. **감지**: Layer 3 초안 작성 중 위임 조건을 충족하는 구성요소를 식별한다
2. **확인**: 사용자에게 위임 여부를 질문한다:
   > "이 구성요소([이름])는 자체적으로 복잡한 서브시스템입니다. 구체 구현 대신 인터페이스만 정의하고, 별도의 progressive-planning 세션으로 위임하시겠습니까?"
3. **경계 정의**: 위임이 확정되면 구체 구현 대신 다음만 작성한다:
   - `[하위 계획 위임]` 마커
   - **인터페이스/경계**: 이 구성요소가 외부에 노출하는 공개 API, 이벤트, 데이터 구조
   - **책임 요약**: 이 구성요소가 수행해야 하는 핵심 역할 한 줄
   - **제약사항**: 상위 계획에서 부여하는 제약 (성능, 패턴, 의존성 등)
4. **기록**: 최종 계획서의 "위임된 하위 계획" 섹션에 목록으로 표시한다

### 위임 마커 형식

```
#### [구성요소명] — [하위 계획 위임]

> 이 구성요소는 별도의 progressive-planning 세션에서 세부 설계를 진행한다.

##### 인터페이스 경계
- [외부에 노출하는 공개 API/이벤트/데이터 구조]

##### 책임
- [핵심 역할 한 줄]

##### 상위 계획의 제약
- [이 서브시스템이 지켜야 할 제약사항]
```

---

## Phase 4: 최종 정리 및 출력

### Step 15: 문서 꾸밈 수준 결정

`AskUserQuestion`으로 최종 문서의 꾸밈 수준을 질문한다:

> "최종 문서의 꾸밈 수준을 선택해주세요:
> - **간결** (minimal): 최소한의 마크다운. 헤더, 리스트, 볼드 정도만 사용
> - **표준** (standard): 표, 강조, 구분선, 체크리스트 등 구조적 마크다운 활용 [기본값]
> - **풍부** (rich): 표준 + 콜아웃/인용, Mermaid 다이어그램, 뱃지, 색상 강조 등 최대한 활용"

**수준별 동작 차이:**

| 요소 | 간결 | 표준 | 풍부 |
|------|------|------|------|
| 헤더/리스트/볼드 | ✅ | ✅ | ✅ |
| 표 (테이블) | ❌ | ✅ | ✅ |
| 체크리스트 | ❌ | ✅ | ✅ |
| 구분선/구조적 레이아웃 | ❌ | ✅ | ✅ |
| 콜아웃/인용 블록 | ❌ | ❌ | ✅ |
| Mermaid 다이어그램 | ❌ | 필요 시 | ✅ 적극 활용 |
| 색상 강조/뱃지 | ❌ | ❌ | ✅ |

### Step 16: 전체 계획 통합

Layer 1~3의 확정된 내용을 하나의 문서로 통합한다. 최종 계획서 구조는 스코프별 가이드의 "최종 계획서 구조"를 참조한다.

**요구사항 및 의도 정리**: Q&A 과정에서 사용자가 밝힌 의도, 요구사항, 제약을 "요구사항 및 설계 의도" 섹션으로 정리한다. 이 정보는 각 레이어 확정 내용에 녹아있지만, 나중에 구현자가 "왜 이런 결정을 했는가"를 빠르게 파악할 수 있도록 별도로 추출한다.

### Step 17: 최종 검토

> "전체 계획서를 확인해주세요. 수정할 부분이 있으면 알려주세요."

수정 사항이 있으면 반영한다. 없으면 완료.

### Step 18: 후속 조치 안내

`AskUserQuestion`으로 후속 조치를 확인한다:

> "이 계획서를 어떻게 활용하시겠습니까?
> - 파일로 저장 (경로 지정)
> - 바로 구현 시작
> - 특정 레이어를 더 세분화
> - 다른 사람에게 공유할 형식으로 변환"

**"바로 구현 시작"을 선택한 경우:**
1. 최종 계획서를 plan 파일에 기록한다
2. `ExitPlanMode`를 호출하여 Plan 모드를 종료한다
3. 사용자 승인 후 구현을 시작한다

**그 외 선택의 경우:**
1. 해당 작업을 수행한다
2. 추가 작업이 없으면 `ExitPlanMode`를 호출하여 Plan 모드를 종료한다

---

## 질문 유형 분류

모든 질문은 세 가지 유형 중 하나이다:

### 핵심 분기 질문 (Critical Branching)
- `[핵심]` 태그 사용
- 계획의 방향을 결정하는 질문
- **집요/적당 모드에서 건너뛸 수 없다**
- **빠르게 모드에서도 최소 1개는 답변을 받는다**

### 확인 질문 (Confirmation)
- 초안이 맞는지 확인하는 질문
- **적당 모드에서 건너뛸 수 있다**

### 세부 옵션 질문 (Detail Options)
- 세부사항을 결정하는 질문
- **집요 모드에서만 전부 질문한다**

### 건너뛰기 처리

사용자가 "스킵", "건너뛰기", "넘어가기", "skip" 등으로 답하면:
1. 해당 질문이 `[핵심]`인지 확인한다
2. **핵심이면:** "이 질문은 계획 방향에 영향을 줍니다. [이유 한 줄]. 그래도 건너뛰시겠습니까?"라고 한 번 더 확인한다
3. **핵심이 아니면:** 합리적 기본값으로 채우고 "[X]로 가정합니다."라고 알린다

---

## 오류 수정 절차

사용자가 초안에서 오류를 지적하면:

1. 지적된 오류를 인지한다: "다음 부분을 수정합니다: [오류 내용]"
2. 수정된 초안을 다시 제시한다 (수정 부분을 **굵게** 표시)
3. 추가 수정이 필요한지 확인한다
4. 확인 완료 후 원래 흐름으로 돌아간다

**수정 범위:**
- 현재 레이어에만 해당하면 현재 레이어만 수정
- 상위 레이어에 영향을 미치면 해당 상위 레이어부터 다시 정제
- 하위 레이어에 영향을 미치면 아직 작성 전이므로 자연히 반영

---

## 중단 및 재개

사용자가 "여기까지", "나중에 계속", "중단"이라고 하면:

1. 현재까지 확정된 내용을 정리하여 출력한다
2. 어디까지 진행되었는지 표시한다: "Layer [N]의 [구성요소명]까지 완료되었습니다."
3. 재개 시 필요한 정보를 안내한다
