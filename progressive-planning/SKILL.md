---
name: progressive-planning
description: 계획, 설계, 구현을 한 번에 완성하지 않고 점진적으로 조립하는 대화형 워크플로우. 큰 그림에서 세부사항으로 레이어별 질문과 정제를 반복하며 계획을 구축한다. 인자로 "--depth thorough|moderate|quick"과 주제를 받을 수 있다. Use for planning, designing, or implementing anything that benefits from incremental refinement. Do NOT use for simple tasks completable in one step.
---

# 점진적 계획 수립 워크플로우

**이 스킬이 활성화되면 가장 먼저 `EnterPlanMode` 도구를 호출하여 Plan 모드로 진입한다.**

이 스킬의 문서(phases/, references/, domains/)는 워크플로우 진행에 따라 순차적으로 로드된다. **명시적으로 파일을 로드하라는 지침이 있을 때만** 해당 파일을 읽는다. 선제적으로 미리 읽지 않는다. 현재 페이즈가 끝나면 문서 하단의 **"다음 단계"** 지침을 반드시 확인하고, 해당 지침에 따라 다음 페이즈로 넘어간다.

## 핵심 원칙

| 원칙 | 설명 |
|------|------|
| 한 번에 완성하지 않는다 | 레이어별로 초안 → 질문 → 정제 → 확정을 반복한다 |
| 위에서 아래로 내려간다 | 상위 레이어 확정 후 하위 레이어를 시작한다 |
| 핵심 분기를 건너뛰지 않는다 | `[핵심]` 질문은 반드시 답변을 받는다 |
| 초안 오류는 즉시 수정한다 | 오류 지적 시 수정 후 다시 제시한 뒤 진행한다 |
| 질문 강도는 사용자가 결정한다 | 질문의 양과 깊이는 사용자 설정 강도에 따른다 |

## 질문 체계

### 질문 전달 방식

**`AskUserQuestion` 사용** — 선택지로 명확히 정의되는 질문:

| 파라미터 | 제약 |
|----------|------|
| questions | 각 질문당 선택지 2~4개 (Other는 자동 추가) |
| header | 12자 이내 |
| multiSelect | 복수 선택이 필요할 때 `true` |

**일반 텍스트 사용** — 개방형 질문, 초안과 함께 피드백 요청, 여러 질문 나열.

### 질문 유형과 건너뛰기

| 유형 | 태그 | 집요 | 적당 | 빠르게 | 건너뛰기 시 |
|------|------|------|------|--------|------------|
| 핵심 분기 | `[핵심]` | 전부 | 전부 | 최소 1개 | 한 번 더 확인 후 허용 |
| 확인 | — | 전부 | 건너뛰기 가능 | 전부 건너뜀 | 기본값으로 채움 |
| 세부 옵션 | — | 전부 | 일부만 | 전부 건너뜀 | 기본값으로 채움 |

**건너뛰기 기본값 결정**: 기존 자료/패턴 우선 → 가장 보수적/단순한 선택 → 나중에 변경하기 쉬운 쪽

## 다이어그램 규칙

시각화 시 **Mermaid** 문법을 사용한다.

| 상황 | 다이어그램 |
|------|-----------|
| 의존성/관계 | `graph` |
| 처리 흐름 | `sequenceDiagram` |
| 상태 전이 | `stateDiagram-v2` |
| 클래스 구조 | `classDiagram` |

## 에이전트 활용 원칙

계획 수립 시 에이전트(Task 도구의 서브에이전트)를 활용하여 기존 자료를 탐색하고 계획의 근거를 확보한다.

### 활용 시점

- **초기화 Step 4**에서 사용자가 "기존 자료 탐색"을 선택한 경우
- **방향 설정 / 구조 설계 / 세부 명세**에서 초안 작성 전 추가 조사가 필요한 경우
- **도메인 가이드**가 에이전트 활용을 명시한 경우

### 공통 규칙

| 규칙 | 설명 |
|------|------|
| 병렬 launch 우선 | 독립적인 탐색은 최대 3개까지 병렬로 launch한다 |
| 결과 요약 통합 | 에이전트 결과를 수신한 뒤 핵심 발견사항을 요약하여 사용자에게 공유한다 |
| 초안에 반영 | 에이전트가 발견한 기존 패턴, 제약을 해당 레이어 초안에 반영한다 |
| 과도한 탐색 금지 | 해당 레이어의 초안 작성에 필요한 범위로 한정한다 |

### 에이전트 유형

도메인 가이드가 사용할 에이전트를 지정한다. 에이전트는 [agents/](agents/) 폴더에 frontmatter로 등록되며, `subagent_type`으로 호출한다.

## 일반적 처리 규칙

| 상황 | 처리 |
|------|------|
| 오류 수정 | 수정된 초안을 다시 제시 (수정 부분 **굵게**). 상위 레이어 영향 시 해당 레이어부터 재정제 |
| 중단 및 재개 | 현재까지 확정된 내용 정리 + 진행 지점 표시 |

---

## 초기화

Step 1 → 2 → 3 → 4 **무조건** 순차적으로 실행한다. 건너뛰거나 순서를 바꾸지 않는다.

### Step 1: 질문 강도 결정

인자에 `--depth` 값이 있으면 해당 레벨로 설정한다. 없으면 질문한다:

> "질문 강도를 선택해주세요:
> - **집요** (thorough): 모든 분기점과 세부사항을 질문합니다. 빈틈없는 계획을 만듭니다.
> - **적당** (moderate): 핵심 분기만 질문하고 나머지는 합리적 판단으로 채웁니다. [기본값]
> - **빠르게** (quick): 핵심 질문 1-2개만 하고 빠르게 진행합니다."

**강도별 동작 차이:**

| 동작 | 집요 | 적당 | 빠르게 |
|------|------|------|--------|
| 핵심 분기 질문 | 전부 질문 | 전부 질문 | 최소 1-2개만 |
| 확인 질문 | 전부 질문 | 건너뛰기 가능 | 전부 건너뜀 |
| 세부 옵션 질문 | 전부 질문 | 일부만 질문 | 전부 건너뜀 |
| 대안 제시 (단계 A') | 모든 레이어 | 핵심 분기에서만 | 없음 (권장안 직행) |
| 초안 제시 후 확인 | 매 레이어 | 매 레이어 | Layer 1만 |
| 레이어 간 중간 정리 | 수행 | 간략 수행 | 생략 |

**스코프별 기본값 (`--depth` 미지정 시):**

| 스코프 | 규모 | 기본 강도 |
|--------|------|---------|
| 프로젝트 수준 | 대규모 | 집요 |
| 프로젝트 수준 | 중규모 | 적당 |
| 세부 설계 수준 | 복잡 | 적당 |
| 세부 설계 수준 | 단순 | 빠르게 |

### Step 2: 주제, 스코프 파악

인자에 주제가 있으면 해당 주제로 시작한다. 없으면 반드시 텍스트로 입력받는다 (`AskUserQuestion` 사용 금지):

> "무엇에 대한 계획/설계를 수립하시겠습니까? 한 줄로 목표를 설명해주세요."

응답을 바탕으로 **스코프**를 판단하고 해당 레이어 가이드를 로드한다:

- **프로젝트 수준** → [project-scope.md](references/project-scope.md) — 전체 시스템, 여러 모듈에 걸친 계획
- **세부 설계 수준** → [detail-scope.md](references/detail-scope.md) — 특정 기능, 모듈 내부 설계

스코프에 따라 각 레이어의 의미가 달라진다:

| 레이어 | 프로젝트 수준 | 세부 설계 수준 |
|--------|--------------|---------------|
| Layer 1 | 큰 그림 — 목표, 주요 단계, 범위 | 설계 방향 — 목적, 접근법 선택, 설계 의도 |
| Layer 2 | 구성요소 — 역할, 산출물, 의존성 | 구조 설계 — 구성요소, 인터페이스, 흐름 |
| Layer 3 | 세부 명세 — 작업 항목, 완료 조건 | 실행 명세 — 구체적 항목, 데이터, 패턴 |

### Step 3: 도메인 판단

1. 주제를 바탕으로 대략적인 도메인을 판단하여 사용자에게 제시한다
2. **해당 스킬 폴더 내** `domains/` 의 하위 항목을 검색하여 사용 가능한 도메인 목록을 확인한다 (예: [domains/software-dev/](domains/software-dev/))
3. 판단한 도메인과 매칭되는 항목이 있으면 해당 도메인의 `guide.md`를 로드한다. 애매하면 사용자에게 질문하여 확정한다. 없으면 범용 절차만으로 진행한다

### Step 4: 기존 자료 탐색 여부

> "이 계획과 관련된 기존 자료(문서, 코드베이스, 참고 자료 등)가 있습니까?"

- **"있어요, 탐색해주세요"** → 도메인 가이드에 탐색 절차가 있으면 따르고, 없으면 기존 문서/참고 자료를 직접 읽고 핵심 내용을 정리한다. 탐색 결과를 **기존 자료 요약**으로 정리하여 사용자에게 공유한다.
- **"없어요 / 바로 할게요"** → 탐색 없이 방향 설정으로 직행한다

---

## 방향 설정 진행

초기화 완료 후, 다음 단계를 순서대로 진행한다:
1. [phases/01_direction.md](phases/01_direction.md) - 방향 설정
2. [phases/02_structure.md](phases/02_structure.md) - 구조 설계
3. [phases/03_specification.md](phases/03_specification.md) - 명세 작성
4. [phases/04_finalization.md](phases/04_finalization.md) - 최종화
